pico-8 cartridge // http://www.pico-8.com
version 42
__lua__
#include util.lua
#include animation.lua
#include spell.lua
#include combatant.lua
#include battle.lua

function _init()
  local warrior = warrior_new("vlad")
  local wizard = wizard_new("merl")
  --local elf = elf_new("lyra")
  local players = { warrior, wizard }

  local enemies = {}
  for i = 1, 4, 1 do
    add(enemies, goblin_new(i))
  end

  battle = battle_new(players, enemies)
end

function _update()
  battle:update()
end

function _draw()
  cls(2)
  battle:draw()
end

__gfx__
00000000000777700000000000000000000000000000000000000000000000000000000000000000000000e00000000000000070000000000000000000000000
00000000000007000000000000000000000000000000000000000000000000000000dd0000000000000000e00000000000000070000000000000000000000000
00700700000070000000000000000000000000000000000000000000ddd00000000deed000000dd0000000e0000bb08800000070000bb0880000000000000000
0007700000077770000000000000000000000000000000000000ddddeeed0000000deed00000deed000000e33333b800000000733333b8000000000000000000
000770007770000000000000000000000000000ddd000000000deedee7eed0000000dd000000deed000000e03eee3300000000703eee33000000000000000000
00700700070000000000000000000000000000deeed0000000deeedeee7ed000000000ddd0000dd0000000e00ffef330000000700ffef3300000000000000000
00000000777000000000000000000000000000deeed0000000de7eedeeeed00000000de7ed000000000000e00fffee00000000700fffee000000000000000000
00000000000000000000000000000000000000ee7eed000000de7eeeeded00000000deeeeed00000000066666333ee00000066666333ee000000000000000000
0060000000000000000000000000000000000edee7edd00000deeeedeeddd0000000deededed000000000044ffbebe0000000044ffbebe000000000000000000
077777000000000000000000000000000000de7deeded0000dedeede7edeed000000de7edeed000000000044ffbbbe0000000044ffbbbe000000000000000000
777700000000000000000000000000000000deeee7eed0000deeddeeede7ed0000000deede7d000000000000033b300000000000033b30000000000000000000
7776000000000000000000000000000000000dddeeeed0000de7eedede7eed0000dd00dd0dd00000000000000b44b300000000000b44b3000000000000000000
0000000000000000000000000000000000000000dddd000000deeededeeed0000deed000000dd00000000000ffbb330000000000ffbb33000000000000000000
000000000000000000000000000000000000000000000000000dddd00ddd00000deed00000deed0000000000ff3bff0000000000ff3bff000000000000000000
000000000000000000000000000000000000000000000000000000000000000000dd000000deed0000000000ff00ff0000000000ff00ff000000000000000000
000000000000000000000000000000000000000000000000000000000000000000000000000dd000000000044400440000000004440044000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000088888000000000000000000000000000000000000000000000007777770000000000000000000000000000000000000
00000000000000000000000000000000000888880000000000000000000000000000000000000000000077777777000000000000000000000000000000000000
00000000000000000000000000000000000089888000000000000008888880000000000000000000000777000077700000000000000000000000000000000000
00000000000000000000000000000000000008998880000000000888888800000000000000000000007770000007770000000077770000000000000000000000
00000000000000000000000000000000000008999888000000008888988000000000000000000000077700000000777000000777777000000000000000000000
00000000000000000000000000000000000089999988800000088889980000000000000000000000077000000000077000007770077700000000000770000000
00000000000000000000000000000000000089979998800000888899980000000008888000000000077000000000077000007700007700000000007777000000
00000000000000000000000000000000000889977999880000888997998000000000088888000000077000000000077000007700007700000000007777000000
00000000000000000000000000000000008899777999980008888977998880000000008988880000077000000000077000007770077700000000000770000000
00000000000000000000000000000000088997777799980008889977999888000000088999888000077700000000777000000777777000000000000000000000
00000000000000000000000000000000089977777779980008899777799988000008889979988800007770000007770000000077770000000000000000000000
00000000000000000000000000000000009977777779980008997777799988000088899777998800000777000077700000000000000000000000000000000000
00000000000000000000000000000000008997777779900008997777799888000088997777998800000077777777000000000000000000000000000000000000
00000000000000000000000000000000000997777799000000899777999800000088997777998800000007777770000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000077777777700000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000007700000000000007777777000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000076000000000000777770000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000800760000000000007777700000000000000000000000000000000000000000000000000000000000000000000bb0880000000000bb0880
770000088880000000876888800000000777770000888800000000000000000000888800000000000088000000000000070000033333b80000000033333b8000
760000086888000008880868880000007777700000868880000000000000000000868880000000000088088880000000007000003eee330000000003eee33000
07600000f6680000088580f66800000077777080000f66800000000000000080000f6680000000000066086888000000000700000ffef33000000000ffef3300
00760808ff880880405668ff8808800000000080008ff8288800000000000080008ff82888000000006600f668000000000070060fffee0000000000ff6ee400
00078088228284480005882282844800777777886882228444800000777777886882228444800000000588ff8808000000000760b3333e000000000b3363e400
00088468888284480000088882844800066666886688828444800000066666886688828444800000000058228228800000000642bbbbf4400007777777644000
00802850882584480000008825844800000000800008828444800000000000800008828444800000000008888258800000006004244334400000000044644000
00008840885084480000008850844800000000800008858444800000000000800008858444800000000000882508800000000000033b30000000000033630000
00000006666508800000066665088000000000000066066888000000000000000066066888000000000066666508800000000000fb44b3000000000fb44b3000
0000004560664000000045606640000000000000045600664000000000000000045600664000000000004560664800000000000fffbb33f00000000ffbb33f00
0000004400044000000044000440000000000000044000004400000000000000044000004400000000004400044000000000000ff03b0ff00000000ff3b0ff00
00000644000660000006440006600000000000006440000644000000000000006440000644000000000644000660000000000044400004400000000440004440
03000000000000000030000000000000000007777000000000000000000000000070000000000000000000000000000000000000000000000000000000000000
0300000000cc0000003000000cc00000000777700000cc00000000000000cc00707000000cc00000000000000000000000000000000000000000000000000000
030000000cc0000000300000cc00000000777700000cc00000000000000cc00000707000cc000000000000000000000000000000000000000000000000000000
03000000ccc000000030000ccc0000000077700000ccc0000000000000ccc0000070000ccc00000000000000000000bb0880000000000000000000bb08800000
0030000444cc0000000300444cc00000077770000444cc00000000000444cc00000700444cc00000000000000033333b80000000000000000033333b80000000
00300ccccc4400000003ccccc44000000777700ccccc44000000000ccccc44007007ccccc4400000000000000003eee330000000000000000003eee330000000
00300000eecccc000003000eecccc0000000000000eecccc0000000000eecccc0007000eecccc000000000007777777f33000000000000000000ffef33000000
00300007677000000003007677000000033330000767700003333000076770000007007677000000077777777777fffee0000000000000060000fffee0000000
000fc0c777cc00000000f55777c0000000000f333377cc0000000f333377cc000000f55777c00000000000060000b3333e000000000000060000b3333e000000
000fccc777ccc0000000f5fcccc0000000000fccc7333cc000000fccc7333cc00000f5fcccc000007777777644f3bbbbf44000007777777644f3bbbbf4400000
0003ccc7775ccf00000035fcccc00000000000ccc777533f000000ccc777533f000075fcccc000000000000644ff3443344000000000000644ff344334400000
0003c0007c44cf00000035007c400000000000c0007c44cf000000c0007c44cf000075007c400000000000060000033b30000000000000060000033b30000000
00003004ccc5c00000000304cc5000000000000004ccc5c00000000004ccc5c000000704cc5000000000000000ffbb44b3f000000000000000ffbb44b3f00000
000030c45ccc5000000003c4ccc500000000000c45ccccc50000000c45ccccc5000007c4ccc500000000000000fff3bb3fff00000000000000fff3bb3fff0000
000030c555ccc000000003c55ccc00000000000c5cc05ccc0000000c5cc05ccc000007c55ccc000000000000000ff03b00fff00000000000000ff03b00fff000
00003444004440000000044404440000000000444000044400000044400004440000044404440000000000000044400000044000000000000044400000044000
67700000888800000000088880000067000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
66670008882000000000888200000667000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
666700b888880000000c888880000470000000000000000000000000000000000000000000000000000000000000000000000007000000000000000000000007
446000bb87370000000cc875700044000000000000000000000000000000000000000000000000000000000000000000000000ff0000000000000000000000ff
004bb00333bb0330cc00555cc0cc40000000000000000000000000000000000000000000000000000000000000000000000004f50000000000000000000004f5
0003bb42b3bb03305cc42c5cc0cc0000000000000000000000000000000000000000000000000000000000000000000000000444000000000000000000000444
00034b442222400005c44222240000000000000000000000000000000000000000000000000000000000000000000000000fb3470000000000000000000fb347
000004244444b300000244444c500000000000000000000000000000000000000000000000000000000000000000000000feb344000000000000000000feb344
00000002222bbb0000002222ccc00000000000000000000000000000000000000000000000000000000000000000000000ee3b34000000000000000000ee3b34
00000044422bb30000044422cc5000000000000000000000000000000000000000000000000000000000000000000000fef033340000000000000000fef03334
000003444043300000c44404550000000000000000000000000000000000000000000000000000000000000000000000ffe008820000000000000000ffe00882
000003330000000000ccc000000000000000000000000000000000000000000000000000000000000000000000000000fe00feb30000000000000000fe00feb3
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000febb00000000000000000000febb
000000555555000000055555500000000000000000000000000000000000000000000000000000000000000000000000000f4e0b0000000000000000000f4e0b
00000555555550000055555555000000000000000000000000000000000000000000000000000000000000000000000000044400000000000000000000044400
00000055555500000005555550000000000000000000000000000000000000000000000000000000000000000000000000244200000000000000000000244200
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000070000000060
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000006660000000000000000007708806600
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000006dd06000000000000000000788788000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000060000000000000000000000087270000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000066606600000000000000000082820000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000ddd666566005000000000f002880000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000d666565555500000000fff00280000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000d66d65d656650000000ffeff000ff00
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000d6d6656d66665000000ff0effffef00
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000d6d665666d6d600000ff00ffff00ef0
000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000d6000655667d700000ffe00eee000ef0
000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000d6006d655666dd0000eee05ee5000eee
000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000d006dd00655666000f0f0f555000f0ff
000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000d606d000000550d00f0f00000000f0ef
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000006660000000dd00f0000000000000f
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000006660000000dd0000000000000000
