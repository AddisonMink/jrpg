pico-8 cartridge // http://www.pico-8.com
version 42
__lua__
#include battle.lua

function combatant_new(type, name, sprite, position, hp, strength)
  return {
    type = type,
    name = name,
    sprite = sprite,
    position = position,
    hp_max = hp,
    hp = hp,
    strength = strength
  }
end

function combatant_row(combatant)
  return combatant.type == "player" and 1
      or (9 - combatant.position) % 3 + 1
end

function combatant_col(combatant)
  return combatant.type == "player" and combatant.position
      or flr((9 - combatant.position) / 3) + 1
end

function warrior_new(name, position)
  local sprite = 1
  local hp = 10
  local strength = 1
  return combatant_new("player", name, sprite, position, hp, strength)
end

function goblin_new(position)
  local sprite = 2
  local hp = 3
  local strength = -1
  return combatant_new("enemy", "goblin", sprite, position, hp, strength)
end

player1 = warrior_new("bart", 1)
player2 = warrior_new("vlad", 2)
player3 = warrior_new("lena", 3)
player4 = warrior_new("zara", 4)
enemy1 = goblin_new(1)
enemy2 = goblin_new(2)
enemy3 = goblin_new(3)
enemy4 = goblin_new(4)
enemy5 = goblin_new(5)

players = {
  player1,
  player2,
  player3,
  player4
}

enemies = {
  enemy1,
  enemy2,
  enemy3,
  enemy4,
  enemy5
}

combatants = {}

state = "start"
t0 = 0

function _init()
  battle = battle_new(players, enemies)
end

function _update()
  battle:update()
end

function _draw()
  cls(2)
  battle:draw()
end

__gfx__
0000000070ff00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000070ff00000088000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00700700708880000008800000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000770000f850f00004bb40700000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0007700000660f000b44440700000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0070070000440000b02200b000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000060060000b00b00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000040004000400400000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00600000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
07777700000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
77770000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
77760000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
